[{"id":"33f1bf54.efff3","type":"subflow","name":"Respond to Alexa","info":"","in":[{"x":50,"y":30,"wires":[{"id":"7871d08b.25808"}]}],"out":[]},{"id":"7871d08b.25808","type":"template","z":"33f1bf54.efff3","name":"Format Response","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n    \"version\": \"1.0\",\n    \"response\": {\n        \"outputSpeech\": {\n            \"type\": \"PlainText\",\n            \"text\": \"{{payload}}\"\n        },\n        \"shouldEndSession\": true\n    }\n}","x":193,"y":115,"wires":[["e42fe2c1.3a52b","1d48d11d.7b879f"]]},{"id":"e42fe2c1.3a52b","type":"json","z":"33f1bf54.efff3","name":"JSON Encode Response","x":341,"y":194,"wires":[["678543fc.ee3e0c","e02dbbeb.5b5038"]]},{"id":"678543fc.ee3e0c","type":"file","z":"33f1bf54.efff3","name":"Write to Alexa Response","filename":"home/pi/alexa_communication/alexa_response.json","appendNewline":false,"createDir":true,"overwriteFile":"true","x":560.5,"y":283,"wires":[]},{"id":"e02dbbeb.5b5038","type":"debug","z":"33f1bf54.efff3","name":"","active":true,"console":"false","complete":"false","x":449.5,"y":362,"wires":[]},{"id":"1d48d11d.7b879f","type":"debug","z":"33f1bf54.efff3","name":"","active":true,"console":"false","complete":"false","x":230,"y":269,"wires":[]},{"id":"e94769bb.af93a8","type":"switch","z":"e73b0776.2e9808","name":"Sort By Request Type","property":"payload.request.type","propertyType":"msg","rules":[{"t":"eq","v":"LaunchRequest","vt":"str"},{"t":"eq","v":"IntentRequest","vt":"str"},{"t":"else"}],"checkall":"true","outputs":3,"x":148,"y":255.5,"wires":[[],["7120c2e8.fecbcc"],[]]},{"id":"7120c2e8.fecbcc","type":"switch","z":"e73b0776.2e9808","name":"Sort By Intent","property":"payload.request.intent.name","propertyType":"msg","rules":[{"t":"eq","v":"HelloWorldIntent","vt":"str"},{"t":"eq","v":"LogWorkoutIntent","vt":"str"},{"t":"eq","v":"CardioIntent","vt":"str"},{"t":"eq","v":"SetMoodWeatherIntent","vt":"str"},{"t":"eq","v":"WorkoutMusicIntent","vt":"str"},{"t":"eq","v":"DoorLockedIntent","vt":"str"},{"t":"eq","v":"QuickStatsIntent","vt":"str"}],"checkall":"true","outputs":7,"x":129,"y":538.5,"wires":[["1b984490.93db2b"],["a28ac8d2.951ac8"],["404a0149.aa1bc"],["97cc821c.b8b4b"],["c530a21f.12ddb"],[],["9bd76b71.2053d8"]]},{"id":"a5ef2af7.5a3628","type":"debug","z":"e73b0776.2e9808","name":"Input Request","active":true,"console":"true","complete":"payload","x":420,"y":79.5,"wires":[]},{"id":"c21ad098.38af9","type":"file in","z":"e73b0776.2e9808","name":"Read Request File","filename":"home/pi/alexa_communication/alexa_request.json","format":"utf8","x":142,"y":119,"wires":[["20b023f.5fa90dc","a5ef2af7.5a3628"]]},{"id":"241f73ed.29f41c","type":"watch","z":"e73b0776.2e9808","name":"Watch for Alexa Request","files":"home/pi/alexa_communication/alexa_request.json","x":139,"y":38,"wires":[["c21ad098.38af9"]]},{"id":"20b023f.5fa90dc","type":"json","z":"e73b0776.2e9808","name":"","x":96,"y":179.5,"wires":[["e94769bb.af93a8"]]},{"id":"a28ac8d2.951ac8","type":"function","z":"e73b0776.2e9808","name":"Extract Weight","func":"msg.payload = msg.payload.request.intent.slots.weight.value\n\nmsg.topic = \"UPDATE sets \\\n set weight = \" + msg.payload + \" where weight IS NULL \\\n LIMIT 1;\"\n\nreturn msg;","outputs":1,"noerr":0,"x":429.5,"y":441.5,"wires":[["2b4724dd.6e42fc"]]},{"id":"2b4724dd.6e42fc","type":"mysql","z":"e73b0776.2e9808","mydb":"f1b416d6.a33a48","name":"Log Workout","x":505,"y":492.5,"wires":[["aa132485.24dbd8"]]},{"id":"a5a0e43a.ce95a8","type":"inject","z":"e73b0776.2e9808","name":"Test Log Workout","topic":"","payload":"50","payloadType":"num","repeat":"","crontab":"","once":false,"x":387.5,"y":546.5,"wires":[["94736a47.b14bb8"]]},{"id":"94736a47.b14bb8","type":"function","z":"e73b0776.2e9808","name":"Extract Weight","func":"msg.topic = \"UPDATE sets \\\n set weight = \" + msg.payload + \" where weight IS NULL \\\n LIMIT 1;\"\n\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":594.5,"wires":[["2b4724dd.6e42fc"]]},{"id":"aa132485.24dbd8","type":"function","z":"e73b0776.2e9808","name":"Get Next Set","func":" msg.topic = \"Select exercise, set_number, reps FROM exercises, sets \\\n where exercises.exercise_id = sets.exercise_id \\\n and weight IS NULL Limit 1;\"\nreturn msg;","outputs":1,"noerr":0,"x":636.5,"y":542.5,"wires":[["5df6b65.5017848"]]},{"id":"5df6b65.5017848","type":"mysql","z":"e73b0776.2e9808","mydb":"f1b416d6.a33a48","name":"Next Set","x":685,"y":478.5,"wires":[["d68bad02.0e76b"]]},{"id":"d68bad02.0e76b","type":"function","z":"e73b0776.2e9808","name":"Replay with next set","func":"msg.payload = \"Successful Log, \\\nnext is set \" + msg.payload[0].set_number + \" of \"\n+ msg.payload[0].exercise + \" for \" \n+ msg.payload[0].reps + \" reps\"\nreturn msg;","outputs":1,"noerr":0,"x":858,"y":493.5,"wires":[["b3b59e3f.cd2b5","b6faa4e6.c77458"]]},{"id":"97cc821c.b8b4b","type":"template","z":"e73b0776.2e9808","name":"Play weather","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"weather playlist","x":544,"y":1075.5,"wires":[["52b6406b.8b42d"]]},{"id":"c530a21f.12ddb","type":"template","z":"e73b0776.2e9808","name":"Starting Workout","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"starting workout","x":558,"y":1251.5,"wires":[["1dbc825e.24caee","e71f3ea6.18d52"]]},{"id":"1b984490.93db2b","type":"template","z":"e73b0776.2e9808","name":"Say Testing","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"super fast test","x":411,"y":380.5,"wires":[["dc94a3ab.03de5"]]},{"id":"dc94a3ab.03de5","type":"subflow:33f1bf54.efff3","z":"e73b0776.2e9808","x":644.5,"y":328,"wires":[]},{"id":"b3b59e3f.cd2b5","type":"subflow:33f1bf54.efff3","z":"e73b0776.2e9808","x":1066,"y":451,"wires":[]},{"id":"b6faa4e6.c77458","type":"debug","z":"e73b0776.2e9808","name":"","active":true,"console":"false","complete":"false","x":1010.5,"y":557,"wires":[]},{"id":"404a0149.aa1bc","type":"switch","z":"e73b0776.2e9808","name":"Start/Stop Cardio","property":"payload.request.intent.slots.cardiocommand.value","propertyType":"msg","rules":[{"t":"eq","v":"start","vt":"str"},{"t":"eq","v":"stop","vt":"str"}],"checkall":"true","outputs":2,"x":421.5,"y":652,"wires":[["a60c08f9.924778"],["871e6031.4f259"]]},{"id":"a60c08f9.924778","type":"exec","z":"e73b0776.2e9808","command":"python home/pi/fitbit_python/fitbit_run.py","addpay":true,"append":"","useSpawn":"","timer":"","name":"Fitbit Python","x":738,"y":679,"wires":[["40d0f294.20fa4c","5ed42c4b.65c1d4"],[],[]]},{"id":"9f2426b8.c73938","type":"debug","z":"e73b0776.2e9808","name":"","active":true,"console":"false","complete":"false","x":1309,"y":726.5,"wires":[]},{"id":"5bc4fac2.2a0eb4","type":"function","z":"e73b0776.2e9808","name":"assemble query","func":"\nmsg.topic = \"INSERT INTO cardio \\\n(run_time, start_distance, start_steps) \\\nVALUES (\" + msg.payload.date + \", \" + msg.payload.distance + \",\" + \nmsg.payload.steps + \")\"\n\nreturn msg;","outputs":1,"noerr":0,"x":997,"y":728.5,"wires":[["bfa2020d.d7e85"]]},{"id":"5ed42c4b.65c1d4","type":"json","z":"e73b0776.2e9808","name":"","x":848,"y":767.5,"wires":[["5bc4fac2.2a0eb4"]]},{"id":"40d0f294.20fa4c","type":"debug","z":"e73b0776.2e9808","name":"","active":true,"console":"false","complete":"false","x":951.5,"y":613.5,"wires":[]},{"id":"d7f2b51a.316c28","type":"template","z":"e73b0776.2e9808","name":"Alexa Response","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"Started cardio, have fun!","x":1364.5,"y":645,"wires":[["20641a24.338ff6"]]},{"id":"871e6031.4f259","type":"exec","z":"e73b0776.2e9808","command":"python home/pi/fitbit_python/fitbit_run.py","addpay":true,"append":"","useSpawn":"","timer":"","name":"Fitbit Python","x":679,"y":812,"wires":[["bed23c77.57a0b"],[],[]]},{"id":"83538975.530608","type":"function","z":"e73b0776.2e9808","name":"assemble query","func":"msg.topic = \"UPDATE cardio \\\nset end_distance = \" + msg.payload.distance + \n\", end_steps = \" + \nmsg.payload.steps + \" where end_distance IS NULL LIMIT 1;\"\n\nreturn msg;","outputs":1,"noerr":0,"x":879,"y":889.5,"wires":[["795ecba8.500664"]]},{"id":"bed23c77.57a0b","type":"json","z":"e73b0776.2e9808","name":"","x":730,"y":928.5,"wires":[["83538975.530608","7ed42e15.4efd4"]]},{"id":"7ed42e15.4efd4","type":"debug","z":"e73b0776.2e9808","name":"query","active":true,"console":"false","complete":"payload","x":878,"y":985,"wires":[]},{"id":"b1fad99e.45f248","type":"function","z":"e73b0776.2e9808","name":"Get Cardio information","func":" msg.topic = \"Select start_steps, end_steps, \\\n start_distance, end_distance \\\n FROM cardio \\\nORDER BY run_id DESC LIMIT 1;\"\nreturn msg;","outputs":1,"noerr":0,"x":1129.5,"y":944,"wires":[["20d0a358.88007c"]]},{"id":"d78176c9.700608","type":"function","z":"e73b0776.2e9808","name":"Replay with cardio stats","func":"var total_d = msg.payload[0].end_distance - msg.payload[0].start_distance;\nvar total_steps = msg.payload[0].end_steps - msg.payload[0].start_steps;\nmsg.payload = \"Successful Log, \\\nyou ran \" + total_d + \" miles, taking \" + total_steps +\n\" steps.\";\nreturn msg;","outputs":1,"noerr":0,"x":1397,"y":897,"wires":[["e3560cf.30c70f","3ed4f93d.0646b6"]]},{"id":"e3560cf.30c70f","type":"debug","z":"e73b0776.2e9808","name":"","active":true,"console":"false","complete":"false","x":1442,"y":958,"wires":[]},{"id":"20641a24.338ff6","type":"subflow:33f1bf54.efff3","z":"e73b0776.2e9808","x":1572.5,"y":639,"wires":[]},{"id":"3ed4f93d.0646b6","type":"subflow:33f1bf54.efff3","z":"e73b0776.2e9808","x":1633,"y":857,"wires":[]},{"id":"bfa2020d.d7e85","type":"mysql","z":"e73b0776.2e9808","mydb":"f1b416d6.a33a48","name":"Log Current","x":1157,"y":672,"wires":[["9f2426b8.c73938","d7f2b51a.316c28"]]},{"id":"795ecba8.500664","type":"mysql","z":"e73b0776.2e9808","mydb":"f1b416d6.a33a48","name":"Log final","x":1060,"y":878,"wires":[["b1fad99e.45f248"]]},{"id":"20d0a358.88007c","type":"mysql","z":"e73b0776.2e9808","mydb":"f1b416d6.a33a48","name":"Get Final Stats","x":1276,"y":846,"wires":[["d78176c9.700608"]]},{"id":"52b6406b.8b42d","type":"openweathermap","z":"e73b0776.2e9808","name":"Weather: Oakville, Ontario","wtype":"current","lon":"","lat":"","city":"Oakville","country":"Canada","x":846,"y":1096,"wires":[["daf70296.8025d","13fd09d0.e91e76"]]},{"id":"a62a2aa5.b394d8","type":"switch","z":"e73b0776.2e9808","name":"Hot or Cold","property":"payload.tempc","propertyType":"msg","rules":[{"t":"gte","v":"25","vt":"num"},{"t":"lt","v":"25","vt":"str"}],"checkall":"true","outputs":2,"x":1013.5,"y":1236,"wires":[["9187fa66.b935b8"],["b628f8b0.1dee38"]]},{"id":"9187fa66.b935b8","type":"exec","z":"e73b0776.2e9808","command":"python home/pi/Alexa-Media/musicplayer.py Hot","addpay":true,"append":"","useSpawn":false,"timer":"800","name":"Play Hot Playlist","x":1212,"y":1207,"wires":[[],[],[]]},{"id":"b628f8b0.1dee38","type":"exec","z":"e73b0776.2e9808","command":"python home/pi/Alexa-Media/musicplayer.py Cold","addpay":true,"append":"","useSpawn":false,"timer":"","name":"Play Cold Playlist","x":1198,"y":1282,"wires":[[],[],[]]},{"id":"daf70296.8025d","type":"switch","z":"e73b0776.2e9808","name":"Raining?","property":"payload.weather","propertyType":"msg","rules":[{"t":"eq","v":"Rain","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":901.5,"y":1161,"wires":[[],["a62a2aa5.b394d8"]]},{"id":"13fd09d0.e91e76","type":"template","z":"e73b0776.2e9808","name":"Alexa Response","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"Setting the mood","x":1148.5,"y":1082,"wires":[["1c2006c7.667599"]]},{"id":"1c2006c7.667599","type":"subflow:33f1bf54.efff3","z":"e73b0776.2e9808","x":1433,"y":1076,"wires":[]},{"id":"1dbc825e.24caee","type":"exec","z":"e73b0776.2e9808","command":"python home/pi/Alexa-Media/musicplayer.py Workout","addpay":true,"append":"","useSpawn":false,"timer":"800","name":"Play Workout Playlist","x":787,"y":1379,"wires":[[],[],[]]},{"id":"e71f3ea6.18d52","type":"template","z":"e73b0776.2e9808","name":"Alexa Response","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"Ok, let's do this!","x":824,"y":1295,"wires":[["dd6633e5.a8519"]]},{"id":"dd6633e5.a8519","type":"subflow:33f1bf54.efff3","z":"e73b0776.2e9808","x":1060.5,"y":1372,"wires":[]},{"id":"9bd76b71.2053d8","type":"switch","z":"e73b0776.2e9808","name":"Get Stats Command","property":"payload.request.intent.slots.cardiocommand.value","propertyType":"msg","rules":[{"t":"eq","v":"quick","vt":"str"},{"t":"eq","v":"sleep","vt":"str"},{"t":"eq","v":"workout","vt":"str"}],"checkall":"true","outputs":3,"x":461,"y":1545,"wires":[["97b3db6c.d0f618"],["7be60dc7.d63dd4"],[]]},{"id":"97b3db6c.d0f618","type":"exec","z":"e73b0776.2e9808","command":"python home/pi/fitbit_python/fitbit_quick_stats.py","addpay":true,"append":"","useSpawn":false,"timer":"800","name":"Get Quick Stats","x":694,"y":1473,"wires":[["4df84741.b9e318"],[],[]]},{"id":"e87da9a8.bbe448","type":"debug","z":"e73b0776.2e9808","name":"","active":true,"console":"false","complete":"false","x":1083.5,"y":1499,"wires":[]},{"id":"4df84741.b9e318","type":"template","z":"e73b0776.2e9808","name":"Format Response","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n    \"version\": \"1.0\",\n    \"response\": {\n        \"outputSpeech\": {\n            \"type\": \"PlainText\",\n            \"text\": \"{{payload}}\"\n        },\n        \"shouldEndSession\": true\n    }\n}","x":899,"y":1448,"wires":[["92a67935.d524d8","e87da9a8.bbe448"]]},{"id":"92a67935.d524d8","type":"file","z":"e73b0776.2e9808","name":"Write to Alexa Response","filename":"home/pi/alexa_communication/alexa_response.json","appendNewline":false,"createDir":true,"overwriteFile":"true","x":1127.5,"y":1449,"wires":[]},{"id":"7be60dc7.d63dd4","type":"exec","z":"e73b0776.2e9808","command":"python home/pi/fitbit_python/fitbit_sleep.py","addpay":true,"append":"","useSpawn":false,"timer":"800","name":"Get Sleep Stats","x":740,"y":1548,"wires":[["a823e67a.fb9288"],[],[]]},{"id":"a823e67a.fb9288","type":"template","z":"e73b0776.2e9808","name":"Format Response","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n    \"version\": \"1.0\",\n    \"response\": {\n        \"outputSpeech\": {\n            \"type\": \"PlainText\",\n            \"text\": \"{{payload}}\"\n        },\n        \"shouldEndSession\": true\n    }\n}","x":954,"y":1547,"wires":[["7c88fcc8.6d35a4","827c5a73.9c2708"]]},{"id":"827c5a73.9c2708","type":"debug","z":"e73b0776.2e9808","name":"","active":true,"console":"false","complete":"false","x":1138.5,"y":1598,"wires":[]},{"id":"7c88fcc8.6d35a4","type":"file","z":"e73b0776.2e9808","name":"Write to Alexa Response","filename":"home/pi/alexa_communication/alexa_response.json","appendNewline":false,"createDir":true,"overwriteFile":"true","x":1182.5,"y":1548,"wires":[]},{"id":"f1b416d6.a33a48","type":"MySQLdatabase","z":"e73b0776.2e9808","host":"127.0.0.1","port":"3306","db":"alexapi","tz":"UTC"}]